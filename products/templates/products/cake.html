{% extends "products/base.html" %}

{% block title %}
    Cake Items
{% endblock %}

<style>
  .card-span {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .card-img-top {
    height: 250px; /* Adjust the height to fit within the card */
    object-fit: cover;
    width: 100%; /* Ensure the image takes the full width of the card */
  }
  .card-body {
    flex-grow: 1;
  }
  .card {
    width: calc(100% / 4); /* Set the width based on the number of items per row */
    max-width: 250px; /* Set a maximum width for each card container */
    height: auto; /* Allow the height to adjust dynamically based on content */
}


</style>

{% block body %}
{% load static %}

<section class="py-0 overflow-hidden">
  <div class="container">
    <div class="row h-100">
      <div class="col-lg-7 mx-auto text-center mt-4 mb-5">
        <h5 class="fw-bold fs-3 fs-lg-5 lh-sm">Cake items</h5>
      </div>
      <div class="col-12">
        <div class="carousel slide" id="carouselPopularItems" data-bs-touch="false" data-bs-interval="false">
          <div class="carousel-inner">
            <div class="carousel-item active" data-bs-interval="10000">
              <div class="row gx-3 h-100 align-items-center">
                {% for cake in cakes %}
                <div class="col-sm-6 col-md-4 col-xl mb-5 h-100">
                  <div class="card card-span h-100 rounded-3">
                    <img class="img-fluid rounded-3 card-img-top" style="height:250px !important" src="{{cake.image.url}}" alt="{{cake.title}}" />
                    <div class="card-body ps-0 text-center">
                      <h5 class="fw-bold text-1000 text-truncate mb-1">{{cake.title}}</h5>
                      <div>
                        {% if cake.discount_price %}
                          <span class="text-muted"><del>Tk. {{cake.price}}</del></span>
                          <span class="text-danger fw-bold"> Tk. {{cake.discount_price}}</span>
                        {% else %}
                          <span class="text-1000 fw-bold">Tk. {{cake.price}}</span>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  <div class="d-grid gap-2 mt-2">
                    <button class="btn btn-lg btn-primary add-to-cart-btn" data-product-id="{{ cake.id }}">Add to Cart</button>
                    <a class="btn btn-lg btn-danger" href="{% url 'product-detail' cake.id %}" role="button">Quick View</a>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div><!-- end of .container-->
</section>

<!-- Pagination Controls -->
{% if cakes.has_other_pages %}
<div class="container">
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-4">
      {% if cakes.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page=1" aria-label="First">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      {% endif %}
      {% for num in cakes.paginator.page_range %}
      <li class="page-item {% if num == cakes.number %}active{% endif %}">
        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
      </li>
      {% endfor %}
      {% if cakes.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ cakes.paginator.num_pages }}" aria-label="Last">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endif %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  jQuery(document).ready(function($) {
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    $('.add-to-cart-btn').click(function(event) {
      event.preventDefault();
      var productId = $(this).data('product-id');
      var csrftoken = getCookie('csrftoken');

      $.ajax({
        type: 'POST',
        url: '/addtocart/' + productId + '/',
        data: {
          'product_id': productId,
          'quantity': 1
        },
        headers: {
          'X-CSRFToken': csrftoken
        },
        success: function(data) {
          console.log('Product added to cart successfully!');
        },
        error: function(xhr, textStatus, errorThrown) {
          console.log('Error:', errorThrown);
        }
      });
    });
  });
</script>

{% endblock %}
